class Game{update(){Background.render(),requests.map(e=>e.render()),goals.map(e=>e.render())}}
class GameState{constructor(){this.state="start_menu",this.dead=!0,this.stage=0}initiateLevel(e){setTimeout(areAllRequestsConnected,e.timeLimit),this.halfway=0,this.backing=0,this.steps=[],this.dead=!1,Background.setMap(e.map),this.spawnRequests(),this.spawnGoals()}spawnRequests(){void 0!==level.getCurrentLevel().requests&&level.getCurrentLevel().requests.map(e=>{let t=new Request(cx);t.y=64*e.location[0],t.x=64*e.location[1],t.start=[e.start[0],e.start[1]],t.goal=[e.goal[0],e.goal[1]],requests.push(t)})}spawnGoals(){void 0!==level.getCurrentLevel().goals&&level.getCurrentLevel().goals.map(e=>{let t=new Goal(cx);t.y=64*e.location[0],t.x=64*e.location[1],goals.push(t)})}}
class Goal{constructor(t){let s=new Image;s.src="assets/images/file.png",this.context=t,this.image=s,this.x=0,this.y=0,this.destination=[0,0],this.xFrame=0,this.yFrame=0}render(){this.context.drawImage(this.image,this.xFrame,this.yFrame,32,32,this.x,this.y,64,64)}}
class Levels{constructor(t){this.currentLevel=t,this.levels=[{name:"level1",timeLimit:1e4,requests:[{location:[0,4],start:[0,4],goal:[7,4]},{location:[4,0],start:[4,0],goal:[4,7]}],goals:[{location:[7,4]},{location:[4,7]}],map:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,0]]},{name:"level2",timeLimit:1e4,requests:[{location:[0,4],start:[0,4],goal:[7,4]},{location:[4,0],start:[4,0],goal:[4,7]},{location:[3,0],start:[3,0],goal:[4,7]}],goals:[{location:[7,4]},{location:[4,7]},{location:[3,7]}],map:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,0]]},{name:"level3",timeLimit:1e4,requests:[{location:[0,4],start:[0,4],goal:[7,4]},{location:[4,0],start:[4,0],goal:[4,7]},{location:[3,0],start:[3,0],goal:[4,7]},{location:[3,7],start:[3,7],goal:[4,7]}],goals:[{location:[7,4]},{location:[4,7]},{location:[3,7]},{location:[2,7]},{location:[1,7]}],map:[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,1],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,0]]}]}selectedTile(t,e){let l,o;return l=t>0&&t<520?t/64:t>519?7:0,o=e>0&&e<520?e/64:e>519?7:0,[Math.floor(o),Math.floor(l)]}changeTile(t,e){let l=this.selectedTile(t,e);console.log(l),this.levels[this.currentLevel].map[l[0]][l[1]]>8?this.levels[this.currentLevel].map[l[0]][l[1]]=0:this.levels[this.currentLevel].map[l[0]][l[1]]+=1}getCurrentLevel(){return this.levels[this.currentLevel]}setNextLevel(){this.currentLevel++}}
class Music{constructor(){}play(){}playMove(){}}
class Request{constructor(s){let t=new Image;t.src="assets/images/request.png",this.context=s,this.image=t,this.x=0,this.y=0,this.start=[0,0],this.goal=[0,0],this.xFrame=0,this.yFrame=0}isConnected(s){let t=this.start,e=this.goal,i=this.navigate(s,t,[t]);return-1!==searchForArray(i,e)}navigate(s,t,e=[]){return this.possibleMovements(s,t,e).forEach(t=>{e.push(t),this.navigate(s,t,e)}),e}possibleMovements(s,t,e){let i=t[0],r=t[1],h=this.isNorthPossible(s,i,r),a=this.isEastPossible(s,i,r),o=this.isSouthPossible(s,i,r),n=this.isWestPossible(s,i,r),u=[];!1!==h&&u.push(h),!1!==a&&u.push(a),!1!==o&&u.push(o),!1!==n&&u.push(n);let l=[];return u.forEach(s=>{-1===searchForArray(e,s)&&l.push(s)}),l}isNorthPossible(s,t,e){return 0!==t&&(0!==s[t-1][e]&&[t-1,e])}isEastPossible(s,t,e){return 7!==e&&(0!==s[t][e+1]&&[t,e+1])}isSouthPossible(s,t,e){return 7!==t&&(0!==s[t+1][e]&&[t+1,e])}isWestPossible(s,t,e){return 0!==e&&(0!==s[t][e-1]&&[t,e-1])}render(){this.context.drawImage(this.image,this.xFrame,this.yFrame,32,32,this.x,this.y,64,64)}}
class TextInterface{constructor(){}renderStart(){cx.font="50px Arial Black",cx.fillStyle="#FFF",cx.fillText("404",200,170),cx.font="20px Arial Black",cx.fillText("File not found",175,220),cx.fillText("Press <Space> to play",135,350),cx.font="8px Arial",cx.fillText("Created by: Daivan Trinh & HÃ¥kan Einarsson for js13kGames.com 2020",10,500)}renderEnd(){cx.font="50px Arial Black",cx.fillStyle="#FFF",cx.fillText("The End",145,170),cx.font="20px Arial Black",cx.fillText("Thank you for playing our game",85,220),cx.font="15px Arial Black",cx.fillText("Created by Daivan Trinh & Hakan Einarsson",75,350)}renderDead(){cx.font="30px Arial Black",cx.fillStyle="#FF0000",cx.fillText("404 Files not found",140,170),cx.font="20px Arial Black",cx.fillText("Press <space> to try again",115,350)}}
class TileSheet{constructor(t){let e=new Image;e.src="assets/images/wires.png",this.context=t,this.image=e,this.map=[]}setMap(t){this.map=t}render(){let t=0;this.map.length>0&&this.map.map(e=>{let a=0;e.map(e=>{let s=this.calculate(e);0!==e&&this.context.drawImage(this.image,s[0],s[1],32,32,64*a,64*t,64,64),a++}),t++})}calculate(t){return 1===t?[0,0]:2===t?[32,0]:3===t?[64,0]:4===t?[0,32]:5===t?[32,32]:6===t?[64,32]:7===t?[0,64]:8===t?[32,64]:9===t?[64,64]:void 0}}
let vendors=["webkit","moz"];for(let e=0;e<vendors.length&&!window.requestAnimationFrame;++e)window.requestAnimationFrame=window[vendors[e]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[e]+"CancelAnimationFrame"]||window[vendors[e]+"CancelRequestAnimationFrame"];let requests=[],goals=[],textInterface=new TextInterface,game=new Game,gameState=new GameState,level=new Levels(0),canvas=document.getElementById("canvas"),cw=canvas.width,ch=canvas.height,fps=30,interval=1e3/fps,lastTime=(new Date).getTime(),currentTime=0,delta=0;cx=canvas.getContext("2d");let Background=new TileSheet(cx),music=new Music;function areAllRequestsConnected(){let e=!0;requests.forEach(t=>{!1===t.isConnected(level.getCurrentLevel().map)&&(e=!1)}),e?(console.log("you did good"),level.setNextLevel(),3===level.currentLevel?gameState.state="end":gameState.initiateLevel(level.getCurrentLevel())):(gameState.state="dead",console.log("lost!!!"))}let state={pressedKeys:{space:!1,left:!1,right:!1,up:!1,down:!1}},keyMap={Enter:"we tryin",ArrowRight:"right",ArrowLeft:"left",ArrowUp:"up",ArrowDown:"down",Space:"space"};function keydown(e){let t=keyMap[e.code];state.pressedKeys[t]=!0}function keyup(e){let t=keyMap[e.code];state.pressedKeys[t]=!1}function onClick(e){level.changeTile(e.pageX,e.pageY)}function searchForArray(e,t){var a,n,r;for(a=0;a<e.length;++a)if(t.length===e[a].length){for(r=e[a],n=0;n<t.length&&t[n]===r[n];++n);if(n===t.length)return a}return-1}function gameLoop(){window.requestAnimationFrame(gameLoop),state.pressedKeys.space&&"start_menu"===gameState.state&&(gameState.initiateLevel(level.getCurrentLevel()),gameState.state="level1"),state.pressedKeys.space&&!0===gameState.dead&&(gameState.initiateLevel(level.getCurrentLevel()),gameState.state="inGame"),currentTime=(new Date).getTime(),(delta=currentTime-lastTime)>interval&&(cx.clearRect(0,0,cw,ch),"start_menu"===gameState.state?(cx.clearRect(0,0,cw,cw),textInterface.renderStart()):"end"===gameState.state?(cx.clearRect(0,0,cw,cw),textInterface.renderEnd()):"dead"===gameState.state?(game.update(),textInterface.renderDead()):game.update(),lastTime=currentTime-delta%interval)}function loadImage(e){return new Promise(t=>{let a=new Image;a.onload=(()=>t(a)),a.src=e})}window.addEventListener("keydown",keydown,!1),window.addEventListener("keyup",keyup,!1),window.addEventListener("click",onClick,!1),Promise.all([loadImage("assets/images/file.png"),loadImage("assets/images/request.png"),loadImage("assets/images/wires.png")]).then(()=>{gameLoop()});